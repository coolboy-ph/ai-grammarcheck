<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grammar Check AI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --background: #171717;
            --surface: #262626;
            --surface-hover: #3a3a3a;
            --primary: #3b82f6;
            --text-primary: #f5f5f5;
            --text-secondary: #a3a3a3;
            --border: #404040;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background);
            color: var(--text-primary);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- Scrollbar Styling --- */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--background);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--surface-hover);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--border);
        }

        /* --- Main Layout --- */
        .header {
            background: var(--background);
            padding: 12px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }

        .header h1 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .new-chat-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .new-chat-btn:hover {
            background: var(--surface);
            border-color: var(--surface-hover);
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 820px;
            margin: 0 auto;
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        /* --- Welcome Screen --- */
        .welcome-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 24px;
            gap: 24px;
        }

        .welcome-logo {
            width: 64px;
            height: 64px;
            background: var(--surface);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--border);
        }

        .welcome-logo svg {
            width: 32px;
            height: 32px;
            color: var(--primary);
        }

        .welcome-title {
            font-size: 24px;
            font-weight: 600;
        }

        .welcome-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
            max-width: 400px;
        }

        .example-prompts {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            width: 100%;
            max-width: 500px;
            margin-top: 24px;
        }

        .prompt-card {
            background: var(--surface);
            border: 1px solid var(--border);
            padding: 16px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .prompt-card:hover {
            background: var(--surface-hover);
            border-color: var(--surface-hover);
            color: var(--text-primary);
        }

        /* --- Message Styling --- */
        .message-wrapper {
            display: flex;
            gap: 16px;
            max-width: 90%;
            transition: opacity 0.3s ease-in-out;
        }

        .message-wrapper.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }
        
        .message-wrapper.user.processing {
            opacity: 0.6;
        }

        .message-wrapper.assistant {
            align-self: flex-start;
        }
        
        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            font-size: 14px;
            flex-shrink: 0;
            border: 1px solid var(--border);
        }

        .user .avatar {
            background: var(--primary);
            color: white;
            border: none;
        }

        .assistant .avatar {
            background: var(--surface);
        }

        .message {
            padding: 12px 16px;
            border-radius: 16px;
            line-height: 1.6;
            font-size: 16px;
            word-break: break-word;
        }

        .user .message {
            background: var(--primary);
            color: white;
            border-top-right-radius: 4px;
        }

        .assistant .message {
            background: var(--surface);
            border-top-left-radius: 4px;
        }
        
        .message b {
            font-weight: 600;
            color: inherit;
        }

        /* --- Typing Indicator --- */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: var(--surface);
            border-radius: 16px;
            border-top-left-radius: 4px;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            background-color: var(--text-secondary);
            border-radius: 50%;
            display: inline-block;
            animation: typing 1.4s infinite ease-in-out both;
        }

        .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing-dots span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }

        /* --- Input Area --- */
        .input-area {
            padding: 16px 24px 24px 24px;
            background: var(--background);
            flex-shrink: 0;
        }

        .input-wrapper {
            position: relative;
            max-width: 820px;
            margin: 0 auto;
            background: var(--surface);
            border-radius: 24px;
            display: flex;
            align-items: center;
            padding: 8px;
            border: 1px solid var(--border);
            transition: border-color 0.2s ease;
        }
        .input-wrapper:focus-within {
            border-color: var(--primary);
        }

        .message-input {
            flex: 1;
            width: 100%;
            background: transparent;
            border: none;
            padding: 10px 16px;
            color: var(--text-primary);
            font-size: 16px;
            resize: none;
            outline: none;
            font-family: inherit;
            line-height: 1.5;
            max-height: 120px;
        }

        .message-input::placeholder {
            color: var(--text-secondary);
        }

        .send-button {
            background: var(--primary);
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
            margin-right: 4px;
        }
        
        .send-button:disabled {
            background: var(--surface-hover);
            cursor: not-allowed;
        }
        .send-button:hover:not(:disabled) {
             filter: brightness(1.1);
        }

        .send-button svg {
            width: 20px;
            height: 20px;
            fill: white;
            margin-left: 2px;
        }

        @media (max-width: 600px) {
            .example-prompts {
                grid-template-columns: 1fr;
            }
            .header {
                padding: 12px 16px;
            }
            .messages, .input-area {
                padding-left: 16px;
                padding-right: 16px;
            }
            .message-wrapper {
                max-width: 95%;
            }
        }

    </style>
</head>
<body>
    <div class="header">
        <h1>Grammar Check AI</h1>
        <button class="new-chat-btn" onclick="clearChat()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14"/><path d="M5 12h14"/></svg>
            <span>New Chat</span>
        </button>
    </div>

    <div class="chat-container">
        <div class="messages" id="messages">
            <div class="welcome-container" id="welcomeContainer">
                <div class="welcome-logo">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/></svg>
                </div>
                <h2 class="welcome-title">How can I help you today?</h2>
                <div class="example-prompts">
                    <div class="prompt-card" onclick="startWithPrompt('She don\'t like apples.')">She don't like apples.</div>
                    <div class="prompt-card" onclick="startWithPrompt('I has a good time yesterday.')">I has a good time yesterday.</div>
                    <div class="prompt-card" onclick="startWithPrompt('He go to the store and buy milk.')">He go to the store and buy milk.</div>
                    <div class="prompt-card" onclick="startWithPrompt('Correct this: Me and my friend is going to the park.')">Correct this: Me and my friend is going to the park.</div>
                </div>
            </div>
            <!-- Messages will be injected here -->
        </div>
        
        <div id="typingIndicatorWrapper" style="display: none;">
             <div class="message-wrapper assistant">
                <div class="avatar">AI</div>
                <div class="typing-indicator">
                    <div class="typing-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            </div>
        </div>


        <div class="input-area">
            <div class="input-wrapper">
                <textarea 
                    class="message-input" 
                    id="messageInput" 
                    placeholder="Ask me to check a sentence..."
                    rows="1"
                    onkeydown="handleKeyDown(event)"
                    oninput="adjustTextareaHeight(this)"
                ></textarea>
                <button class="send-button" id="sendButton" onclick="sendMessage()">
                    <svg viewBox="0 0 24 24">
                        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        let messageHistory = [];
        const historyKey = 'grammarCheckHistory';
        
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const messagesContainer = document.getElementById('messages');
        const welcomeContainer = document.getElementById('welcomeContainer');
        const typingIndicatorWrapper = document.getElementById('typingIndicatorWrapper');

        // The API key is no longer needed on the front-end.
        // We will call our own serverless function instead.
        const endpoint = "/api/chat"; // This now points to our Vercel Serverless Function
        const model = "x-ai/grok-4-fast:free"; // Using a reliable free model
        const systemPrompt = `You are a Grammar Checker. Your job is to check the user’s English sentence and respond using the following rules and format. If the user's input is in Burmese, first translate it to English, then respond only with the Corrected Sentence and Alternative Expressions sections.
Rules:
- Always be clear and concise.
- Use simple language; avoid technical grammar jargon.
- Focus on improving fluency and natural expression.
- Point out the exact phrase changed and explain why (keep it short).
- Use natural line breaks, not <br> tags.
- Use a dash (-) for bullet points.

Format:
✅ **Corrected Sentence**
Provide the corrected version with proper grammar.

📝 **Explanation**
Explain the mistakes and corrections in simple, clear language.

💡 **Alternative Expressions**
Suggest 1–3 natural alternative ways to say the same thing.

📚 **Learning Tip**
Share a short, practical tip related to the mistake to help the user remember.

Special Rule for Burmese Input:
If the input is in Burmese, translate it to English and provide only:
✅ **Corrected Sentence**
💡 **Alternative Expressions**`;

        function adjustTextareaHeight(textarea) {
            textarea.style.height = 'auto'; // Reset height
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }

        function handleKeyDown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function startWithPrompt(promptText) {
            messageInput.value = promptText;
            sendMessage();
        }

        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            const userMessageElement = addMessage(message, 'user');
            userMessageElement.classList.add('processing');
            
            messageInput.value = '';
            adjustTextareaHeight(messageInput);
            sendButton.disabled = true;
            
            showTypingIndicator();
            
            try {
                const response = await callApi(message);
                addMessage(response, 'assistant');
            } catch (error) {
                console.error('API Error:', error);
                addMessage("I apologize, but I'm having trouble connecting. Please double-check that your API key is correct and see the browser console for more details.", 'assistant');
            } finally {
                hideTypingIndicator();
                sendButton.disabled = false;
                messageInput.focus();
                userMessageElement.classList.remove('processing');
            }
        }

        async function callApi(userMessage) {
            const apiMessages = [{ role: "system", content: systemPrompt }];
            
            messageHistory.forEach(msg => {
                if (msg.sender === 'user' || msg.sender === 'assistant') {
                    apiMessages.push({
                        role: msg.sender,
                        content: msg.content
                    });
                }
            });
            
            apiMessages.push({ role: "user", content: userMessage });

            const response = await fetch(endpoint, {
                method: 'POST',
                headers: { 
                    'Content-Type': 'application/json'
                    // The Authorization header is removed from here and now handled by the serverless function.
                },
                body: JSON.stringify({
                    model: model,
                    messages: apiMessages
                })
            });

            if (!response.ok) {
                const errorBody = await response.text();
                throw new Error(`API request failed with status ${response.status}: ${errorBody}`);
            }

            const data = await response.json();
            const choice = data.choices && data.choices[0];
            
            if (choice && choice.message && choice.message.content) {
                return choice.message.content;
            } else {
                return "I'm sorry, an error occurred. I could not get a valid response.";
            }
        }
        
        function addMessage(content, sender) {
            const messageElement = renderMessage(content, sender);
            
            messageHistory.push({ content, sender });
            sessionStorage.setItem(historyKey, JSON.stringify(messageHistory));
            return messageElement;
        }

        function renderMessage(content, sender) {
            if (welcomeContainer) {
                welcomeContainer.style.display = 'none';
            }

            const messageWrapper = document.createElement('div');
            messageWrapper.className = `message-wrapper ${sender}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            avatar.textContent = sender === 'user' ? 'You' : 'AI';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message';
            
            let sanitizedContent = content.replace(/</g, "&lt;").replace(/>/g, "&gt;");
            sanitizedContent = sanitizedContent.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
            messageContent.innerHTML = sanitizedContent;
            
            messageWrapper.append(avatar, messageContent);
            messagesContainer.appendChild(messageWrapper);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            return messageWrapper;
        }

        function showTypingIndicator() {
            messagesContainer.appendChild(typingIndicatorWrapper);
            typingIndicatorWrapper.style.display = 'block';
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            typingIndicatorWrapper.style.display = 'none';
        }

        function clearChat() {
            messagesContainer.innerHTML = '';
            if (welcomeContainer) {
                 messagesContainer.appendChild(welcomeContainer);
                 welcomeContainer.style.display = 'flex';
            }
            messageHistory = [];
            sessionStorage.removeItem(historyKey);
            messageInput.focus();
        }
        
        function loadChatHistory() {
            const savedHistory = sessionStorage.getItem(historyKey);
            if (savedHistory) {
                messageHistory = JSON.parse(savedHistory);
                if (messageHistory.length > 0) {
                    messageHistory.forEach(msg => renderMessage(msg.content, msg.sender));
                }
            }
        }

        window.addEventListener('load', () => {
            loadChatHistory();
            messageInput.focus();
            adjustTextareaHeight(messageInput);
        });
    </script>
</body>
</html>

